{% extends "code_doc/base_template.html" %}
{% load gravatar %}
{% load staticfiles %}
{% load static %}
{% load project_image %}
{% load markdown_filter %}

{% block title %}About Code.Doc{% endblock %}

{% block content %}

{% markdown_tag %}

Welcome to the [code_doc](https://bitbucket.org/renficiaud/code_doc) project!
============================

The main purposes of this web application is to easily publish the documentation (and any other artifact) 
associated to your code repository. Those artifacts are the result of some build process of your own on
a build server or on your computer.

`code_doc` aims at the following:

* helps users or potential users discover your projects, its description, features, licensing, copyright, authors...
* helps developers of the project access the API without effort or action: the stored documentation is
  accessible through a browser,
* focus on dynamic content: documentation/artifacts can be pushed to the server from a python script, which makes easy
  the update of the docs when the code is updated,
* storing the documentation and binaries that you want to share, publicly or with your team mates,
* making your projects available to the public or to specific groups and increase their visibility

`code_doc` is powered by [Django](https://www.djangoproject.com/) and is fully [open source](https://bitbucket.org/renficiaud/code_doc). 
The project has a minimual set of dependencies. You are welcome to contribute!

----------------------------

[TOC]


----------------------------

What are the functionalities offered?
=====================================

* suitable for code: each artifact you upload may optionally be associated to a revision and a branch, which eases tracking 
  which version of your code produced the artifact
* Organization into series: a project contains one or more series, each of which having its set of artifacts. Artifacts may
  be shared among several series. This is particularly useful when an artifact is promoted eg. from `develop` to `master` or
  `stable` series.  
* Possibility to upload or update archives, documentation or any kind of artifact directly from a script: this make it convenient
  to plug `code_doc` to your prefered Continuous Build System. The update is done simply with a python script that sends
  the artifacts to the appropriate place.
* The uploaded documentation is not interpreted in any way: it is possible to upload an archive containing HTML or text files
  generated by a wide range of documentation tools (Docbook, Doxygen, Matlab, Sphinx, etc.) as long as this file can be 
  served by a browser.
* Offers fine permissions management: you work on a private personal project, and you want to share the advance within a restricted group
  of people? Your project is public and you want to make it available to anyone?
  `code_doc` addresses these constraints and adapts to various kind of work environment. 
  No need to set up different private servers: only one instance with the proper authorization on project and series.


----------------------------

Ready to set up?
==================

You are certainly convinced by the usefulness (or necessity) of this web site. In the sequel, the three main objects
manipulated by `code_doc` will be detailed.

The two ingredients for being able to push *things* on this server are

* Defining a project
* Defining one or more series for this project


A project contains the following informations:

* the purpose of the project and the services it provides
* how to use the source or binary code (copyrights, location of the source code)
* its maintainers and how to contact them
* its authors
* and a list of series

A series is composed of

* a name
* a description which indicates the purpose of the series (continuous build, /release/, /stable/, /developments/, /experimental/ ...)
* a release date
* a set of permissions indicating what operations are granted to each user/group
* a list of artifacts that can either be single files or archives containing documentation

## Create a project
At the moment, creating a project is an *admin* privilege, so you should ask your administrator to create a project for you.
A project has one or more **maintainers** that have full access to all functionalities for this particular project (`maintainer`
access).

## Create a series
You can create a new series if you have the proper credentials on the project. If this is the case, a "+" button is active right to the 
"Series" header on the project page.

When the series is created, the access rights given to the users or groups of users may be specified. Different type of access are 
provided:

* either the series is public: everybody, logged in or not, is able to download or visualize the artifacts contained in the series. 
  However it is not possible to add or remove an artifact without the proper privileges.
* or the series is restricted: specific users/groups are allowed to read, add or remove artifacts. 

!!! alert "Note"
    Please note that `remove` permission grants automatically `add` permission, and `add` permission grants `view`. 

## Add an artifact
Now that the series is created, one or several artifacts may be added to it. An artifact is more or less a file with some meta-data
that changes the way it is visualized by the application.

It is possible to add an artifact from the web interface or from the command line (detailed below). An artifact may come 
with a revision and/or a branch, which may be created on-the-fly during the upload. Also an artifact may belong to several series 
(for instance an artifact from `continuous` may be promoted to `stable` or `release` series). 

!!! alert
    In order to be able to add an artifact to a series, the user/group should have the `add` permission at the series level, or
    an admin access to the project.

### Revisions and branches
In order to be able to track artifacts with respect to the code that generated those, it is possible to associate an artifact with
a **revision** (number or string):

* A revision may contain several artifacts, but an artifact belongs to at most one revision.
* A revision may be part of one or more branches, a branch may contain several revisions (see `git` for instance).

### Command line upload of an artifact

One of the nice functionalities of *code doc* is to be able to push artifacts on the server. This enables the project/series content to be
update from a build server for instance.

The following steps should be followed:

* have proper credentials that allows you to upload something on this server
* Download [the script]({% url 'script' %}) manually from here or automatically as follow:

        :::bash
        wget {{request.scheme}}://{{request.get_host}}{% url 'script' %} -O script.py

* Create a task in your build scheme that uploads the artifact. For regular artifacts (not documentation):

        :::bash
        python script.py -s {{request.scheme}}://{{request.get_host}} --username=user --password=pass \
               --project="project-name" --artifact_series="stable" \
               -f filetosend.tar.bz2
  
      For documentation, you have to specify an additional flag, `--is_doc` and the main entry point of the documentation with `--doc_entry`:

        :::bash
        python script.py -s {{request.scheme}}://{{request.get_host}} --username=$USER --password=$PASS \
               --project="project-name" --artifact_series="night-builds" \
               --is_doc --doc_entry=my_tar_content/index.html \
               -f filetosend.tar.bz2

The parameters of the upload script are the following:

* `--project` the project to which the artifact belongs. This parameter is *necessary*.
* `--artifact_series` the series to which the artifact will be first stored. This parameter is *necessary*.
* `--file` the file to send. This parameter is *necessary*.
* `--artifact_branch` specifies the branch of the artifact (case sensitive). If the branch is specified and not empty, the revision should
  also be specified.
* `--artifact_revision` indicates the revision of the artifact (case sensitive)
* `--is_doc` if set, indicates that the uploaded file is an archive containing a documentation. In that case `--doc_entry` should be specified
* `--doc_entry` the entry point for the documentation, relative to the root of the deflated archive. The web application
  will serve this file as an entry point for viewing/parsing the documentation
* `--artifact_description` a short description of the artifact  

### Limiting the number of revisions
It is possible to limit the number of revisions at the series level. Each artifact may or not be associated to one unique revision, but a
revision may contain several artifacts. If the series does not have any restriction on this limit (0 or blank), the project default is used
instead. If in turn the project does not have any limit neither, all artifacts are kept.

!!! alert "Remark"
    In case the artifact is not associated to any revision, it is considered as having a *dedicated* revision.

Once the limit over the revisions is reached, all artifacts of the oldest revisions are dissociated from the series:

* a revision is **deleted** if it is not associated to any series,
* a revision is **deleted** when it does not contain any artifact,
* an artifact is **deleted** when it does not belong to any series


## Associating users and authors
It is possible to associate a user with an author. In that case, the associated user may edit the details of the author, otherwise
this permission is granted only to the `admin` of the web application.


Markdown format
---------------
Some fields (mostly description) use the [Markdown](http://daringfireball.net/projects/markdown/) format for having a richer
formatting. 
 
[markdown](http://pythonhosted.org/Markdown/index.html) extension and the code highlighter [pygments](http://pygments.org/). 

To insert some code as explanation, you can do the following

    :::bash
    :::bash
    pip install my_package

If the block above is indented with 4 spaces, then Markdown interprets it as code with the designated language. You can also do

    #!bash
    #!bash
    pip install my_package

instead, and in this case the lines will be numbered. These code blocks can be nested with lists (the indentation then becomes 8 spaces).


----------------------------

# Deployment

The deployment part is a bit out of scope of the current document, and is detailed on the [wiki](https://bitbucket.org/renficiaud/code_doc/wiki/Home)
pages of the project.

----------------------------


{% endmarkdown_tag %}

{% endblock %}
